---
import Layout from '../layouts/Layout.astro';
import Author from "../components/home/Author.astro";
import Service from "../components/home/Service.astro";
import { getCollection } from 'astro:content';

import MarkdownIt from 'markdown-it';

// Initialize markdown-it
const md = new MarkdownIt({
    html: true,        // Enable HTML tags in source
    breaks: true,      // Convert '\n' in paragraphs into <br>
    linkify: true      // Autoconvert URL-like text to links
});

const services = await getCollection('services', ({ data }) => {
    return data.isActive !== false;
});

// Sort services and parse their markdown content
const sortedServices = services
    .sort((a, b) => a.data.order - b.data.order)
    .map(service => ({
        ...service,
        parsedContent: md.render(service.body)
    }));


---

<Layout>
    <main class="flex flex-col lg:flex-row gap-6 p-6 justify-center">
        <div class="flex-1/2 max-w-lg">
            <Author />
        </div>


        <div class="max-w-3xl">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                {sortedServices.map((service) => (
                        <Service
                                header={service.data.header}
                                referenceLink={service.data.referenceLink}
                                referenceLinkText={service.data.referenceLinkText}
                        >
                            <div class="prose prose-sm max-w-none" set:html={service.parsedContent} />
                        </Service>
                ))}
            </div>
        </div>

    </main>
    <footer class="justify-items-center p-8">
        <h2 class="text-2xl text-justify">Contact opnemen?</h2>

        <p class="max-w-2xl text-justify">
            Mail naar <a href="mailto:contact@jipwijnia.nl">contact@jipwijnia.nl</a> voor een fysieke afspraak met een kopje koffie, thee of gewoon water op locatie. Geen kosten van toepassing. Met voorkeur in regio Utrecht.
        </p>
    </footer>
</Layout>